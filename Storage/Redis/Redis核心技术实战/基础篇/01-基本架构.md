# 基本架构

大体来说，一个键值数据库包括了**访问框架、索引模块、操作模块和存储模块**四部分。

访问模式通常有两种：

* 一种是通过函数库调用的方式供外部应用使用。
  * 比如以动态链接库的形式链接到我们自己的程序中，提供键值存储功能；
* 另一种是通过网络框架以 Socket 通信的形式对外提供键值对操作。
  * 这种形式可以提供广泛的键值存储服务

实际的键值数据库也基本采用上述两种方式，例如，RocksDB 以动态链接库的形式使用，而 Memcached 和 Redis 则是通过网络框架访问



### 单线程vs多线程

举个例子，如果一个线程既要处理网络连接、解析请求，又要完成数据存取，一旦某一步操作发生阻塞，整个线程就会阻塞住，这就降低了系统响应速度。如果我们采用不同线程处理不同操作，那么，某个线程被阻塞时，其他线程还能正常运行。但是，不同线程间如果需要访问共享资源，那又会产生线程竞争，也会影响系统效率



### 索引

一般而言，内存键值数据库（例如 Redis）采用哈希表作为索引，很大一部分原因在于，其键值数据基本都是保存在内存中的，而内存的高性能随机访问特性可以很好地与哈希表 O(1) 的操作复杂度相匹配。



### 内存分配器

常用的内存分配器 glibc 的 malloc 和 free。



### 持久化

一种方式是，对于每一个键值对，SimpleKV 都对其进行落盘保存，这虽然让 SimpleKV 的数据更加可靠，但是，因为每次都要写盘，SimpleKV 的性能会受到很大影响。

另一种方式是，SimpleKV 只是周期性地把内存中的键值数据保存到文件中，这样可以避免频繁写盘操作的性能影响。但是，一个潜在的代价是 SimpleKV 的数据仍然有丢失的风险。

不过，为了适应不同的业务场景，Redis 为持久化提供了诸多的执行机制和优化改进