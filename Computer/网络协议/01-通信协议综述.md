# 通信协议综述

## 1. 网络协议

### 协议三要素

语法、语义、顺序
### 网络数据包结构

`Mac头`、`Ip头`、 `Tcp头`、 `Http头`、` 数据体`

## 2. 网络分层

1. 物理层：连接
2. 链路层：定位
3. 传输层：路由
4. 会话层：会话连接机制
5. 应用层：数据封装格式



将子网掩码和 IP 地址按位计算 AND，就可得到网络号。

1. ip addr → 不知道基本没有用Linux
2. ifconfig 和 ip addr 的区别吗？
3. CIDR
4. 共有IP和私有IP
5. MAC地址
6. 网络设备的状态标识

## 3. Ipconfig命令

1. IP设计时犯的错误？

低估了未来网络的发展，32位地址不够用。于是有了现在IPv6（128位）
分类错误。分成了5类。C类太少，B类太多。C类254个，网络都不够；D类6万多，给企业都太多。

2. 那后来者如何弥补IP设计者犯的错误呢？

CIDR，无类型域间选路。
打破原来几类地址设计的做法，将32位IP地址一分二，前者网络号，后者主机号。
如何分呢？
栗子：10.100.122.2/24
24 = 前24位是网络号，那么后8位就是主机号。
那如何用？
如发送行信息给 10.100.122.255
所有以 10.100.122... 开头的机器都能收到。
于是有了两个概念：
广播地址：10.100.122.255
子网掩码：255.255.255.0 -> AND 得到网络号。

3. 每一个城市都有人民广场，IP设计是如何解决的？

公有IP地址和私有IP地址。
搭建世界人民都可以访问的网站，需要共有IP地址
搭建只有学校同学使用饿的网站，只要私有IP地址
例子1: Wi-Fi
 192.168.0.x 是最常用的私有 IP 地址
192.168.0 是网络号
192.168.0.1，往往就是你这个私有网络的出口地址
192.168.0.255 就是广播地址。一旦发送这个地址，整个 192.168.0 网络里面的所有机器都能收到。

例子2: 16.158.165.91/22

4. 如何理解MAC地址？

如果说IP是地址，有定位功能。那Mac就是身份证，唯一识别。



5. 讲了ABC，那是D类是什么？

D 类是组播地址。使用这一类地址，属于某个组的机器都能收到。这有点类似在公司里面大家都加入了一个邮件组。发送邮件，加入这个组的都能收到。组播地址在后面讲述 VXLAN 协议的时候会提到。

6. IP地址scope是什么意思？

对于 eth0 这张网卡来讲，是 global，说明这张网卡是可以对外的，可以接收来自各个地方的包。对于 lo 来讲，是 host，说明这张网卡仅仅可以供本机相互通信。

7. 那lo是什么意思？

lo 全称是loopback，又称环回接口，往往会被分配到 127.0.0.1 这个地址。这个地址用于本机通信，经过内核处理后直接返回，不会在任何网络中出现。

8. < BROADCAST,MULTICAST,UP,LOWER_UP > 是干什么的？

net_device flags，网络设备的状态标识。
UP 表示网卡处于启动的状态；
BROADCAST 表示这个网卡有广播地址，可以发送广播包；
MULTICAST 表示网卡可以发送多播包；
LOWER_UP 表示 L1 是启动的，也即网线插着呢。

9. MTU1500 是指什么意思呢？是哪一层的概念？

最大传输单元 MTU 为 1500，这是以太网的默认值。
MTU 是二层 MAC 层的概念。MAC 层有 MAC 的头，以太网规定连 MAC 头带正文合起来，不允许超过 1500 个字节。

10. qdisc pfifo_fast 是什么意思呢？

排队规则。规定数据包如何进出的。有pfifo, pfifo_fast. 

动态主机配置协议（Dynamic Host Configuration Protocol），简称DHCP

DHCP 协议主要是用来给客户租用 IP 地址、DHCP 协议能给客户推荐“装修队”PXE，能够安装操作系统

## 4 IP

1. 正确配置IP?

CIDR、子网掩码、广播地址和网关地址。

2. 在跨网段调用中，是如何获取目标IP的mac地址的？

从源IP网关获取所在网关mac,
然后又替换为目标IP所在网段网关的mac,
最后是目标IP的mac地址

3. 手动配置麻烦，怎么办？

DHCP！Dynamic Host Configuration Protocol！
DHCP, 让你配置IP，如同自动房产中介。

4. 如果新来的，房子是空的(没有操作系统)，怎么办？

PXE， Pre-boot Execution Environment.
"装修队"PXE，帮你安装操作系统。



